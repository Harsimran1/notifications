
module.exports = require('./lib/express');

var app = require('express')();
var http = require('http').Server(app);
var io = require('socket.io')(http);
var pg = require('pg');
var conString = "postgres://gro:gro123@localhost:5432/gro";

var client = new pg.Client(conString);
client.connect();

app.get('/', function(req, res){
    res.sendfile(__dirname+'/index.html');
});

var notifications=[];

io.on('connection', function(socket){

    console.log('a user connected');
    socket.on('disconnect', function(){
        console.log('user disconnected');
    });
    socket.on('userId', function(data){
        console.log(data.userId);

        var str='SELECT notification_id,notifications.notification.description,users.user_notifications.id,is_read FROM notifications.notification, users.user_notifications WHERE' +
            ' (notifications.notification.id = users.user_notifications.notification_id) AND user_id='+data.userId ;

        var a=client.query(str)

        a.on('row',function(row){
            notifications.push(row);
            console.log(row);
        });
        socket.emit('notifications',notifications);
        notifications=[];

    });

});

http.listen(3000, function(){
    console.log('listening on *:3000');
});


